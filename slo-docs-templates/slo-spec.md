# Спецификация SLI/SLO. <Название CJU или CUD_ID>. <Название этапа CJU>

## Метаданные

| Поле                             | Значение                                                                 |
|----------------------------------|-------------------------------------------------------------------------|
| Принятие SLO                     | имя, SRE                                                                |
| Владелец SLI/SLO                 | Кто отвечает за SLI, должность и упоминание  (команда)                  |
| SLI/SLO утверждающие лица        | список упоминаний                                                       |
| Статус документа                 | Черновик \| На рассмотрении \| К пересмотру \| Действующий \| Аннулирован |
| Связанные документы              | ссылки на связанные документы                                           |
| Дата предложения SLI             | ДД.ММ.ГГГГ                                                              |
| Дата обновления/оптимизации SLI  | ДД.ММ.ГГГГ                                                              |
| Дата утверждения SLI             | ДД.ММ.ГГГГ                                                              |
| Плановая дата пересмотра SLI     | ДД.ММ.ГГГГ                                                              |

---

## Описание SLI

Краткое описание, что показывает.

### Компоненты SLI и их вес

| ID | Вес | Описание                          | Обработчик в приложении                                                                 |
|----|-----|-----------------------------------|----------------------------------------------------------------------------------------|
| W1 | 1   | краткое название операции        | `service_name\|service` — или набор методов для однозначной идентификации источника данных. Пример: `server.address: cashdesk2.vi.net`, `grpc.type: stream`, `grpc.server: cashback.v1.CashbackServer`, `grpc.method: Create` или `http.method: POST`, `url.full: http://vi.ru/` |

---

## SLI/SLO

> Тип SLO выбирается согласно [SLI меню](https://static.googleusercontent.com/media/sre.google/ru//static/pdf/art-of-slos-slides.pdf).

| Тип<sup>1</sup>       | Имя<sup>2</sup>                          | Расчет SLI<sup>3</sup>                          | Цель, %       | Окно наблюдения<sup>4</sup> |
|-----------------------|-----------------------------------------|------------------------------------------------|---------------|-----------------------------|
|                       |                                         | Успешные запросы                               | Подходящие запросы | Достижимая | Желаемая      |                             |
| Доступность           | `префикс_сервиса-имя_sli_availability`  | Запросы W1-N завершенные с кодами http-ответа кроме 404, 500-599 | Запросы W1-N независимо от кода ответа | 99          | 99.9         | 30 дней, скользящее |
| Время ответа          | `префикс_сервиса-имя_sli_latency`       | Запросы W1-N завершенные за <= 2с              | Запросы W1-N независимо от времени ответа | 95          | 99           | 30 дней, скользящее |

### Доска с показателями

[Ссылка на Grafana](https://grafana/d/slo-detail?orgId=1&var-Datasource=Victoriametrics&var-service=SLOTH_SERVICE)

### Особенности

1. Пример особенностей подсчета (например, в одном SLI используется метрика, а в другом нет).
2. Исключения в подсчете и краевые случаи, если есть.

### Запросы для SLI (необязательно)

<details>
<summary>Доступность</summary>

**Неудовлетворительные запросы (инверсия успешных):**  
```
код запроса к метрикам
```

**Подходящие запросы:**  
```
код запроса к метрикам
```
</details>

<details>
<summary>Время ответа</summary>

**Успешные запросы:**  
```
код запроса к метрикам
```

**Подходящие запросы:**  
```
код запроса к метрикам
```
</details>

### Источник данных SLI

| Название источника       | Описание                                                                 |
|--------------------------|-------------------------------------------------------------------------|
| Пример: Victoriametrics  | Метрики собраны по логам nginx (или по логам работы приложений).        |
| Образцы                  | [Пример метрик](http://srv:8080/metrics)                     |

### Развертывание

> SLI как код определен в файлах спецификации для sloth.dev (указать ссылку на файл).

Пример:  
`https://git/runbooks/-/tree/master/slos-catalog/sloth/services/папка_slo/имя_файла.slo.yml`

### Оповещения

| Источник                     | Получатели                             |
|------------------------------|---------------------------------------|
| Правила AlertManager или Zabbix | Название Loop канала или датчика Zabbix |

---

## Политики

<details>
<summary>Политика бюджета ошибок и оповещений</summary>

Ссылка на политику контроля расхода бюджета ошибок (*Триггеры, Пороги эскалации, Оповещение*):  
[Политика контроля бюджета ошибок](/pages/errbudget-control)

### Политика оповещения

Выбрать желаемую в вашей платформе управления SLO.  
[Политика оповещения о расходовании бюджета ошибок](/pages/errbudget-alerting)
</details>

---

## Журнал пересмотра

| Дата       | Изменения                |
|------------|--------------------------|
| ДД.ММ.ГГГГ |                          |

---

### Примечания

<sup>1</sup> Тип по [SLI меню](https://static.googleusercontent.com/media/sre.google/ru//static/pdf/art-of-slos-slides.pdf), например: Доступность (доля успешных запросов), Время ответа (доля подходящих запросов обработанных достаточно быстро), и др.  
<sup>2</sup> Уникальный идентификатор SLI. Латиница, нижний регистр, имя сервиса родителя "-", далее слова разделять "_", в конце добавить название типа SLI для удобства поиска в будущем.  
<sup>3</sup> Отношение числа успешных к числу подходящих запросов, или произведение составных SLI для композитного SLI.  
<sup>4</sup> Длительность в днях, тип: скользящее, календарное.  
